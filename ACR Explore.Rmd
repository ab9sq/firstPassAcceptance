---
title: "Explore ACR"
author: "Nick Lauerman"
date: "December 5, 2018"
output: 
  pdf_document: 
    fig_caption: yes
    fig_height: 7.5
    fig_width: 7.5
    toc: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Libraries
```{r}
#library(lubridate)
```

# Data
## read in
```{r}
ACR.raw <- read.csv(file = "./data/ACR.csv",
                    stringsAsFactors = FALSE)
name <- c("SQA",
          "Application",
          "CRNumber",
          "CRDate",
          "CRApproved",
          "IENumber",
          "IEDate",
          "IEApproved",
          "Reason",
          "Comments")
names(ACR.raw) <- name
rm(name)
ACR <- ACR.raw
```

## Format
### factor
```{r}
ACR$SQA <- as.factor(ACR$SQA)
ACR$Application <- as.factor(ACR$Application)
ACR$CRApproved <- as.factor(ACR$CRApproved)
ACR$IEApproved <- as.factor(ACR$IEApproved)
levels(ACR$IEApproved)[1] <- NA
ACR$Reason <- as.factor(ACR$Reason)
levels(ACR$Reason)[1] <- NA
```

### Dates
```{r}
ACR$CRDate <- as.Date(ACR$CRDate, format = "%d-%b-%y")
ACR$IEDate<- as.Date(ACR$IEDate, format = "%d-%b-%y")
ACR$CRmonth <- lubridate::month(ACR$CRDate, label = TRUE)
ACR$CRyear <- lubridate::year(ACR$CRDate)
ACR$IEmonth <- lubridate::month(ACR$IEDate, label = TRUE)
ACR$IEyear <- lubridate::year(ACR$IEDate)          
```

## Structure
```{r}
str(ACR)
```

# Metrics
## Select nomth
```{r}
work <- subset(ACR,
               subset = (CRmonth == "Nov" & CRyear == 2018) |
                    (subset = IEmonth == "Nov" & IEyear == 2018))
workCR <- subset(ACR,
               subset = CRmonth == "Nov" & CRyear == 2018)
workIE <- subset(ACR,
               subset = IEmonth == "Nov" & IEyear == 2018)
```

## Counts
### Data Changes Request Approved
```{r}
nrow(subset(workCR,
            subset = (CRApproved == "A" |
                           CRApproved == "A-FP")))
```
### Data Change Request Disapproved
```{r}
nrow(subset(workCR,
            subset = (CRApproved == "D")))
```

### IE Approved
```{r}
nrow(subset(workIE,
            subset = (IEApproved == "A" |
                           IEApproved == "A-FP")))
```

### IE Disapproved
```{r}
nrow(subset(workIE,
            subset = (CRApproved == "D")))
```
## First pass acceptance

### CR
```{r}
nrow(subset(workCR,
            subset = CRApproved == "A-FP")) / 
     nrow(workCR) * 100
```

### IE
```{r}
nrow(subset(workIE,
            subset = CRApproved == "A-FP")) / 
     nrow(workIE) * 100
```

### Total Process
```{r}
nrow(subset(work,
            subset = (CRApproved == "A-FP" & IEApproved == "A-FP"))) /
     nrow(work) * 100
```

# Time to complete a data change
This is the interval between CR approval and IE approval
```{r}
work.all <- subset(ACR,
                   subset = ((CRApproved == "A" | CRApproved == "A-FP") &
                                  (IEApproved == "A" | IEApproved == "A-FP")))
work.all <- subset(work.all,
                   subset = (IEmonth == "Nov" & IEyear == 2018))

nrow(work.all)
work.all$Interval <- as.numeric(work.all$IEDate - work.all$CRDate)
summary(work.all$Interval)
sd(work.all$Interval)
table(work.all$Interval)
quantile(work.all$Interval)
hist(work.all$Interval,
     breaks = 20)
boxplot(work.all$Interval)
boxplot(work.all$Interval,
        outline = FALSE)
```

# Number by Application
## Opened
```{r}
table(subset(workCR, 
             subset = CRApproved != "D")$Application)
table(subset(workCR, 
             subset = CRApproved != "D")$SQA)
```
## Completed
```{r}
table(subset(workIE, 
             subset = IEApproved != "D")$Application)

table(subset(workIE, 
             subset = CRApproved != "D")$SQA)
```

## Total
```{r}
table(subset(workCR, 
             subset = CRApproved != "D")$Application) +
     table(subset(workIE, 
             subset = IEApproved != "D")$Application)
table(subset(workCR, 
             subset = CRApproved != "D")$SQA) +
     table(subset(workIE, 
             subset = CRApproved != "D")$SQA)
```

# Number of days that currently open CR have been pending
```{r}
work.open <- subset(ACR,
                    subset = (CRApproved == "A-FP" | CRApproved == "A") & 
                         is.na(IEApproved))
work.open$daysOpen <- as.numeric(as.Date("1-Dec-18", format = "%d-%b-%y") - 
                                      work.open$CRDate)
nrow(work.open)
summary(work.open$daysOpen)
quantile(work.open$daysOpen)
hist(work.open$daysOpen,
     breaks = 20)
boxplot(work.open$daysOpen)
boxplot(work.open$daysOpen,
        outline = FALSE)
```

